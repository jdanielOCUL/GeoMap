<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GDAL: GDAL VB6 Bindings Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>GDAL VB6 Bindings Tutorial </h1>  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="Intro"></a>
Introduction</h2>
<p>A partial set of Visual Basic 6 bindings have been build for GDAL. Internally these bindings use Declare based calls into the GDAL DLL C API but a set of shadow classes are also provided to provide object oriented access to GDAL services in VB6 similar to those provided in C++.</p>
<p>Note that the VB6 bindings are nowhere near comprehensive, nor are they documented. However, in combination with the corresponding C++ class documentation, and the following docs, it should be possible to use GDAL to accomplish a variety of operations. It is not believed that the VB6 bindings will be of any utility with earlier version of VB nor with VB.Net.</p>
<p>The classes for which access has been implemented includes <a class="el" href="classGDALDriver.html" title="Format specific driver.">GDALDriver</a>, <a class="el" href="classGDALDataset.html" title="A set of associated raster bands, usually from one file.">GDALDataset</a>, <a class="el" href="classGDALRasterBand.html" title="A single raster band (or channel).">GDALRasterBand</a>, <a class="el" href="classGDALColorTable.html">GDALColorTable</a>, OGRSpatialReference and OGRCoordinateTransformation.</p>
<p>A mailing list specifically on VB6 GDAL topics has been setup at <a href="http://groups.yahoo.com/group/gdal-vb6-appdev">http://groups.yahoo.com/group/gdal-vb6-appdev</a> .</p>
<h2><a class="anchor" id="UsingVB6"></a>
Using GDAL VB6 Classes</h2>
<p>To use VB6 GDAL bindings it is necessary to ensure that GDAL has been built with appropriate C entry points exported using the "stdcall" calling convention. This is the current default, but was not as recently as GDAL 1.2.6. So ensure you get a version more recent than 1.2.6.</p>
<p>Then add the GDAL VB6 class and module files to your VB6 project. These come from the <a href="http://svn.osgeo.org/gdal/trunk/gdal/vb6">gdal/vb6 directory</a> and include the following key files:</p>
<ul>
<li>
GDAL.bas - The main user visible module. </li>
<li>
GDALCore.bas - This module is for internal use. </li>
<li>
GDALDriver.cls - The <a class="el" href="classGDALDriver.html" title="Format specific driver.">GDALDriver</a> class. </li>
<li>
GDALDataset.cls - The <a class="el" href="classGDALDataset.html" title="A set of associated raster bands, usually from one file.">GDALDataset</a> class. </li>
<li>
GDALRasterBand.cls - The <a class="el" href="classGDALRasterBand.html" title="A single raster band (or channel).">GDALRasterBand</a> class. </li>
<li>
GDALColorTable.cls - The <a class="el" href="classGDALColorTable.html">GDALColorTable</a> class. </li>
<li>
OGRSpatialReference.cls - The OGRSpatialReference class. </li>
<li>
OGRCoordinateTransformation.cls - The OGRCoordinateTransformation class. </li>
</ul>
<p>You may need to edit GDALCore.bas, and change occurrences of gdal12.dll to match what your GDAL DLL is called. You can include a full path to the DLL if it can't be guaranteed to be in the current working directory of the application (or the windows system32 directory).</p>
<p>You should also be able to load the "test" project from the gdal\vb6\test directory. The test project has test menu items roughly corresponding to the tasks in the following tutorial topics.</p>
<h2><a class="anchor" id="TutorialRead"></a>
Tutorial - Read Dataset</h2>
<p>This brief tutorial will demonstrate open a GDAL file, and fetching out some information, about the dataset, and the individual bands. The results are printed to the default from in the following example for simplicity.</p>
<p>Before opening the file we need to register the GDAL format drivers. Normally we will just register all the drivers with <a class="el" href="gdal_8h.html#a9d40bc998bd6ed07ccde96028e85ae26" title="Register all known configured GDAL drivers.">GDALAllRegister()</a>.</p>
<div class="fragment"><pre class="fragment">  Call GDAL.AllRegister()
</pre></div><p>Then we need to try and open the dataset. The GDAL.OpenDS() function returns a <a class="el" href="classGDALDataset.html" title="A set of associated raster bands, usually from one file.">GDALDataset</a> object, so we dimension an appropriate object for this. GDAL.OpenDS() is the VB6 equivalent of the <a class="el" href="classGDALDataset.html#a6764788806a1785c97036d1dba064497" title="Open a raster file as a GDALDataset.">GDALDataset::GDALOpen()</a> function.</p>
<div class="fragment"><pre class="fragment">  Dim ds As <a class="code" href="classGDALDataset.html" title="A set of associated raster bands, usually from one file.">GDALDataset</a>

  Set ds = GDAL.OpenDS( <span class="stringliteral">&quot;utm.tif&quot;</span>, GDAL.GA_ReadOnly )
</pre></div><p>Then we need to check if the open succeeded, and if not report an error.</p>
<div class="fragment"><pre class="fragment">  If not ds.IsValid() Then
    Call MsgBox( <span class="stringliteral">&quot;Open failed: &quot;</span> &amp; GDAL.GetLastErrorMsg() )
    Exit Sub
  End If
</pre></div><p>If things succeeded, we query width of the image in pixels (XSize), Height of the image in pixels (YSize) and number of bands (BandCount) from the dataset properties.</p>
<div class="fragment"><pre class="fragment">  Print <span class="stringliteral">&quot;Size: &quot;</span> &amp; ds.XSize &amp; <span class="stringliteral">&quot;x&quot;</span> &amp; ds.YSize &amp; <span class="stringliteral">&quot;x&quot;</span> &amp; ds.BandCount
</pre></div><p>Next we read metadata from the dataset using the VB6 equivalent of the <a class="el" href="classGDALMajorObject.html#a8ce3bf5795bbebfe9bc643e2152bb360" title="Fetch metadata.">GDALMajorObject::GetMetadata()</a> method, and report it to the user. Metadata is returned as an array of strings of "name=value" items. Array indices start at zero in the returned array. The domain argument should normally be vbNullString though in specialized circumstances other domains might apply.</p>
<div class="fragment"><pre class="fragment">  Dim MD As Variant
  MD = ds.GetMetadata(vbNullString)
  If (UBound(MD) &gt; 0) Then
    Print &quot;Metadata:&quot;
    For i = 1 To UBound(MD)
      Print &quot;  &quot; &amp; MD(i)
    Next i
  End If
</pre></div><p>Parsing the "name=value" strings from GetMetadata() can be a bit of a bother, so if we were looking for specific values we could use GetMetadataItem() and provide a specific item we want to extract. This would extract just the value if it is found, or an empty string otherwise. The GetMetadataItem() is an analog of the C++ <a class="el" href="classGDALMajorObject.html#ad17f496c8b6d0c0be6f52437d3ba8a6d" title="Fetch single metadata item.">GDALMajorObject::GetMetadataItem()</a> method.</p>
<div class="fragment"><pre class="fragment">  Dim MDValue As String

  MDValue = ds.GetMetadataItem( <span class="stringliteral">&quot;TIFF_DATETIME&quot;</span>, vbNullString )
  <span class="keywordflow">if</span> MDValue &lt;&gt; <span class="stringliteral">&quot;&quot;</span> Then
    Print <span class="stringliteral">&quot;Creation Date: &quot;</span> &amp; MDValue
  End If
</pre></div><p>The <a class="el" href="classGDALDataset.html#af9593cc241e7d140f5f3c4798a43a668" title="Fetch the affine transformation coefficients.">GDALDataset::GetGeoTransform()</a> method is used to get fetch the affine transformation used to relate pixel/line locations on the image to georeferenced locations in the current coordinate system. In the most common case (image is not rotated or sheared) you can just report the origin (upper left corner) and pixel size from these values. The method returns 0 on success or an error class if it fails, so we only use the return result (placed into the Geotransform array) on success.</p>
<div class="fragment"><pre class="fragment">  Dim Geotransform(6) As Double

  If ds.GetGeoTransform( Geotransform ) = 0 Then 
    If Geotransform(2) = 0 and Geotransform(4) = 0 Then
      Print &quot;Origin: &quot; &amp; Geotransform(0) &amp; &quot;,&quot; &amp; Geotransform(3)
      Print &quot;Pixel Size: &quot; &amp; Geotransform(1) &amp; &quot;x&quot; &amp; (-1 * Geotransform(5))
    End If
  End If
</pre></div><p>The coordinate system can be fetched using the <a class="el" href="classGDALDataset.html#aa42537e1062ce254d124b29ff3ebe857" title="Fetch the projection definition string for this dataset.">GDALDataset::GetProjectionRef()</a> analog, GDALDataset.GetProjection(). The returned string is in OpenGIS Well Known Text format. A later example will show how to use an OGRSpatialReference object to reformat the WKT into more readable format and make other use of it.</p>
<div class="fragment"><pre class="fragment">  Dim WKT As String

  WKT = ds.GetProjection()
  If Len(WKT) &gt; 0 Then
    Print <span class="stringliteral">&quot;Projection: &quot;</span> &amp; WKT
  End If
</pre></div><p><a class="el" href="classGDALDataset.html" title="A set of associated raster bands, usually from one file.">GDALDataset</a> objects have one or more raster bands associated with them. <a class="el" href="classGDALRasterBand.html" title="A single raster band (or channel).">GDALRasterBand</a> objects can have metadata (accessed the same as on the <a class="el" href="classGDALDataset.html" title="A set of associated raster bands, usually from one file.">GDALDataset</a>) as well as an array of pixel values, and various specialized metadata items like data type, color interpretation, offset/scale. Here we report a few of the items.</p>
<p>First we loop over all the bands, fetching a band object for each band and report the band number, and block size.</p>
<div class="fragment"><pre class="fragment">  For i = 1 To ds.BandCount
    Dim band As <a class="code" href="classGDALRasterBand.html" title="A single raster band (or channel).">GDALRasterBand</a>
           
    Set band = ds.GetRasterBand(i)
    Print <span class="stringliteral">&quot;Band &quot;</span> &amp; i &amp; <span class="stringliteral">&quot; BlockSize: &quot;</span> &amp; band.BlockXSize &amp; <span class="stringliteral">&quot;x&quot;</span> &amp; band.BlockYSize
</pre></div><p>The <a class="el" href="classGDALRasterBand.html" title="A single raster band (or channel).">GDALRasterBand</a> has a DataType property which has the value returned by the C++ method <a class="el" href="classGDALRasterBand.html#ae3ec3bfe18258dd73db3911fed97cc2e" title="Fetch the pixel data type for this band.">GDALRasterBand::GetRasterDataType()</a>. The returned value is an integer, but may be compared to the predefined constants GDAL.GDT_Byte, GDAL.GDT_UInt16, GDAL.GDT_Int16, GDAL.GDT_UInt32, GDAL.GDT_Int32, GDAL.GDT_Float32, GDAL.GDT_Float64, GDAL.GDT_CInt16, GDAL.GDT_CInt32, GDAL.GDT_CFloat32 and GDAL.GDT_CFloat64. In this case we use the GDAL.GetDataTypeName() method to convert the data type into a name we can show the user.</p>
<div class="fragment"><pre class="fragment">    Print <span class="stringliteral">&quot;     DataType=&quot;</span> &amp; GDAL.GetDataTypeName(band.DataType) _
</pre></div><p>We also report the offset, scale, minimum and maximum for the band.</p>
<div class="fragment"><pre class="fragment">    Print <span class="stringliteral">&quot; Offset=&quot;</span> &amp; band.GetOffset() &amp; <span class="stringliteral">&quot; Scale=&quot;</span> &amp; band.GetScale() _
        &amp; <span class="stringliteral">&quot; Min=&quot;</span> &amp; band.GetMinimum() &amp; <span class="stringliteral">&quot; Max=&quot;</span> &amp; band.GetMaximum()
</pre></div><p>GDALRasterBands can also have <a class="el" href="classGDALColorTable.html">GDALColorTable</a> objects associated with them. They are read with the <a class="el" href="classGDALRasterBand.html#a2c5cad0f0fc1b6e261d1e965a5b49969" title="Fetch the color table associated with band.">GDALRasterBand::GetColorTable()</a> analog in VB6. Individual RGBA entries should be read into a 4 Integer array.</p>
<div class="fragment"><pre class="fragment">    Dim ct As <a class="code" href="classGDALColorTable.html">GDALColorTable</a>
    Set ct = band.GetColorTable()
    If ct.IsValid() Then
      Dim CEntry(4) As Integer
      Print &quot;    Has Color Table, &quot; &amp; ct.EntryCount &amp; &quot; entries&quot;
      For iColor = 0 To ct.EntryCount - 1
        Call ct.GetColorEntryAsRGB(iColor, CEntry)
        Print &quot;      &quot; &amp; iColor &amp; &quot;: &quot; &amp; CEntry(0) &amp; &quot;,&quot; &amp; CEntry(1) &amp; &quot;,&quot; &amp; CEntry(2) &amp; &quot;,&quot; &amp; CEntry(3)
      Next iColor
    End If
</pre></div><p>But of course, the most important contents of a GDAL file is the raster pixel values themselves. The C++ <a class="el" href="classGDALRasterBand.html#a5497e8d29e743ee9177202cb3f61c3c7" title="Read/write a region of image data for this band.">GDALRasterBand::RasterIO()</a> method is provided in a somewhat simplified form. A predimensioned 1D or 2D array of type Byte, Int, Long, Float or Double is passed to the RasterIO() method along with the band and window to be read. Internally the "buffer
size" and datatype is extracted from the dimensions of the passed in buffer.</p>
<p>This example dimensions the RawData array to be the size of one scanline of data (XSize x 1) and reads the first whole scanline of data from the file, but only prints out the second and tenth values (since the buffer indexes are zero based).</p>
<div class="fragment"><pre class="fragment">    Dim err As Long
    Dim RawData() As Double
    ReDim RawData(ds.XSize) As Double

    err = band.RasterIO(GDAL.<a class="code" href="gdal_8h.html#ae602fdf251b6b0210a5af5a7cf7623b3ab2abfe1fa6e34018b8c692eb48f35cb5">GF_Read</a>, 0, 0, ds.XSize, 1, RawData)
    if err = 0 Then
      Print &quot;    Data: &quot; &amp; RawData(1) &amp; &quot; &quot; &amp; RawData(9)
    End If
</pre></div><p>Finally, when done accessing a <a class="el" href="classGDALDataset.html" title="A set of associated raster bands, usually from one file.">GDALDataset</a> we can explicitly close it using the CloseDS() method, or just let it fall out of scope in which case it will be closed automatically.</p>
<div class="fragment"><pre class="fragment">    Call ds.CloseDS()
</pre></div><h2><a class="anchor" id="TutorialCreate"></a>
Tutorial - Creating Files</h2>
<p>Next we address creating a new file from an existing file. To create a new file, you have to select a <a class="el" href="classGDALDriver.html" title="Format specific driver.">GDALDriver</a> to do the creating. The <a class="el" href="classGDALDriver.html" title="Format specific driver.">GDALDriver</a> is essentially an object representing a file format. We fetch it with the GetDriverByName() call from the GDAL module using the driver name.</p>
<div class="fragment"><pre class="fragment">    Dim Drv As <a class="code" href="classGDALDriver.html" title="Format specific driver.">GDALDriver</a>

    Call GDAL.AllRegister
    Drv = GDALCore.GetDriverByName( <span class="stringliteral">&quot;GTiff&quot;</span> )
    If Not Drv.IsValid() Then
        Call MsgBox( <span class="stringliteral">&quot;GTiff driver not found &quot;</span> )
        Exit Sub
    End If
</pre></div><p>You could get a list of registered drivers, and identify which support creation something like this:</p>
<div class="fragment"><pre class="fragment">    drvCount = GDAL.GetDriverCount
    For drvIndex = 0 To drvCount - 1
        Set Drv = GDAL.GetDriver(drvIndex)
        If Drv.GetMetadataItem(GDAL.DCAP_CREATE, <span class="stringliteral">&quot;&quot;</span>) = <span class="stringliteral">&quot;YES&quot;</span> _
            Or Drv.GetMetadataItem(GDAL.DCAP_CREATECOPY, <span class="stringliteral">&quot;&quot;</span>) = <span class="stringliteral">&quot;YES&quot;</span> Then
            xMsg = <span class="stringliteral">&quot; (Read/Write)&quot;</span>
        Else
            xMsg = <span class="stringliteral">&quot; (ReadOnly)&quot;</span>
        End If
              
        Print Drv.GetShortName() &amp; <span class="stringliteral">&quot;: &quot;</span> &amp; Drv.GetMetadataItem(GDAL.DMD_LONGNAME, <span class="stringliteral">&quot;&quot;</span>) &amp; xMsg
    Next drvIndex
</pre></div><p>Once we have the driver object, the simplest way of creating a new file is to use CreateCopy(). This tries to create a copy of the input file in the new format. A complete segment (without any error checking) would look like the following. The CreateCopy() method corresponds to the C++ method <a class="el" href="classGDALDriver.html#a2c897da2a6e25169cccc49ef48797ce1" title="Create a copy of a dataset.">GDALDriver::CreateCopy()</a>. The VB6 implementation does not support the use of progress callbacks.</p>
<div class="fragment"><pre class="fragment">    Dim Drv As <a class="code" href="classGDALDriver.html" title="Format specific driver.">GDALDriver</a>
    Dim SrcDS As <a class="code" href="classGDALDataset.html" title="A set of associated raster bands, usually from one file.">GDALDataset</a>, DstDS As GDALDataset

    Call GDAL.AllRegister
    Set Drv = GDALCore.GetDriverByName( <span class="stringliteral">&quot;GTiff&quot;</span> )

    Set SrcDS = GDAL.Open( <span class="stringliteral">&quot;in.tif&quot;</span>, GDAL.GA_ReadOnly )
    Set DstDS = Drv.CreateCopy( <span class="stringliteral">&quot;out.tif&quot;</span>, SrcDS, True, Nothing )
</pre></div><p>This is nice and simple, but sometimes we need to create a file with more detailed control. So, next we show how to create a file and then copy pieces of data to it "manually". The <a class="el" href="classGDALDriver.html#adb7bff9007fa5190d6cf742cf76942a8" title="Create a new dataset with this driver.">GDALDriver::Create()</a> analog is Create().</p>
<div class="fragment"><pre class="fragment">    Set DstDS = Drv.Create(<span class="stringliteral">&quot;out.tif&quot;</span>, SrcDS.XSize, SrcDS.YSize, _
                           SrcDS.BandCount, GDAL.GDT_Byte, Nothing)
</pre></div><p>In some cases we may want to provide some creation options, which is demonstrated here. Creation options (like metadata set through the SetMetadata() method) are arrays of Strings.</p>
<div class="fragment"><pre class="fragment">    Dim CreateOptions(1) As String

    CreateOptions(1) = &quot;PHOTOMETRIC=MINISWHITE&quot;
    Set DstDS = Drv.Create(&quot;out.tif&quot;, SrcDS.XSize, SrcDS.YSize, _
                           SrcDS.BandCount, GDAL.<a class="code" href="gdal_8h.html#a22e22ce0a55036a96f652765793fb7a4a38a66c26861d368e95ba42106ee3ab92">GDT_Byte</a>, CreateOptions)
</pre></div><p>When copying the GeoTransform, we take care to check that reading the geotransform actually worked. Most methods which return CPLErr in C++ also return it in VB6. A return value of 0 will indicate success, and non-zero is failure.</p>
<div class="fragment"><pre class="fragment">    Dim err As Long
    Dim gt(6) As Double

    err = SrcDS.GetGeoTransform(gt)
    If err = 0 Then
        Call DstDS.SetGeoTransform(gt)
    End If
</pre></div><p>Copy the projection. Even if GetProjection() fails we get an empty string which is safe enough to set on the target. Similarly for metadata.</p>
<div class="fragment"><pre class="fragment">    Call DstDS.SetProjection(SrcDS.GetProjection())
    Call DstDS.SetMetadata(SrcDS.GetMetadata(<span class="stringliteral">&quot;&quot;</span>), <span class="stringliteral">&quot;&quot;</span>)
</pre></div><p>Next we loop, processing bands, and copy some common data items.</p>
<div class="fragment"><pre class="fragment">    For iBand = 1 To SrcDS.BandCount
        Dim SrcBand As <a class="code" href="classGDALRasterBand.html" title="A single raster band (or channel).">GDALRasterBand</a>, DstBand As GDALRasterBand
        
        Set SrcBand = SrcDS.GetRasterBand(iBand)
        Set DstBand = DstDS.GetRasterBand(iBand)
        
        Call DstBand.SetMetadata(SrcBand.GetMetadata(<span class="stringliteral">&quot;&quot;</span>), <span class="stringliteral">&quot;&quot;</span>)
        Call DstBand.SetOffset(SrcBand.GetOffset())
        Call DstBand.SetScale(SrcBand.GetScale())

        Dim NoDataValue As Double, Success As Long
        
        NoDataValue = SrcBand.GetNoDataValue(Success)
        If Success &lt;&gt; 0 Then
            Call DstBand.SetNoDataValue(NoDataValue)
        End If
</pre></div><p>Then, if one is available, we copy the palette.</p>
<div class="fragment"><pre class="fragment">        Dim ct As <a class="code" href="classGDALColorTable.html">GDALColorTable</a>
        Set ct = SrcBand.GetColorTable()
        If ct.IsValid() Then
            err = DstBand.SetColorTable(ct)
        End If
</pre></div><p>Finally, the meat and potatoes. We copy the image data. We do this one scanline at a time so that we can support very large images without require large amounts of RAM. Here we use a Double buffer for the scanline, but if we knew in advance the type of the image, we could dimension a buffer of the appropriate type. The RasterIO() method internally knows how to convert pixel data types, so using Double ensures all data types (except for complex) are properly preserved, though at the cost of some extra data conversion internally.</p>
<div class="fragment"><pre class="fragment">        Dim Scanline() As Double, iLine As Long
        ReDim Scanline(SrcDS.XSize) As Double

        &#39; Copy band raster data.
        For iLine = 0 To SrcDS.YSize - 1
            Call SrcBand.RasterIO(GDAL.GF_Read, 0, iLine, SrcDS.XSize, 1, _
                                  Scanline)
            Call DstBand.RasterIO(GDAL.<a class="code" href="gdal_8h.html#ae602fdf251b6b0210a5af5a7cf7623b3a7f8fbb849495a05f2281b9a6fac0e7e2">GF_Write</a>, 0, iLine, SrcDS.XSize, 1, _
                                  Scanline)
        Next iLine
</pre></div><h2><a class="anchor" id="OSRTut"></a>
Tutorial - Coordinate Systems and Reprojection</h2>
<p>The GDAL VB6 bindings also include limited support for use of the OGRSpatialReference and OGRCoordinateTransformation classes. The OGRSpatialReference represents a coordinate system and can be used to parse, manipulate and form WKT strings, such as those returned by the GDALDataset.GetProjection() method. The OGRCoordinateTransformation class provides a way of reprojecting between two coordinate systems.</p>
<p>The following example shows how to report the corners of an image in georeferenced and geographic (lat/long) coordinates. First, we open the file, and read the geotransform.</p>
<div class="fragment"><pre class="fragment">    Dim ds As GDALDataset
    
    Call GDALCore.GDALAllRegister
    Set ds = GDAL.OpenDS(FileDlg.Filename, GDAL.GA_ReadOnly)
    
    If ds.IsValid() Then
        Dim Geotransform(6) As Double
        
        Call ds.GetGeoTransform(Geotransform)
</pre></div><p>Next, we fetch the coordinate system, and if it is non-empty we try to instantiate an OGRSpatialReference from it.</p>
<div class="fragment"><pre class="fragment">        <span class="stringliteral">&#39; report projection in pretty format.</span>
<span class="stringliteral">        Dim WKT As String</span>
<span class="stringliteral">        Dim srs As New OGRSpatialReference</span>
<span class="stringliteral">        Dim latlong_srs As OGRSpatialReference</span>
<span class="stringliteral">        Dim ct As New OGRCoordinateTransformation</span>
<span class="stringliteral"></span>
<span class="stringliteral">        WKT = ds.GetProjection()</span>
<span class="stringliteral">        If Len(WKT) &gt; 0 Then</span>
<span class="stringliteral">            Print &quot;Projection: &quot;</span>
<span class="stringliteral">            Call srs.SetFromUserInput(WKT)</span>
</pre></div><p>If the coordinate system is projected it will have a PROJECTION node. In that case we build a new coordinate system which is the corresponding geographic coordinate system. So for instance if the "srs" was UTM 11 WGS84 then it's corresponding geographic coordinate system would just be WGS84. Once we have these two coordinate systems, we build a transformer to convert between them.</p>
<div class="fragment"><pre class="fragment">            If srs.GetAttrValue(<span class="stringliteral">&quot;PROJECTION&quot;</span>, 0) &lt;&gt; <span class="stringliteral">&quot;&quot;</span> Then
                Set latlong_srs = srs.CloneGeogCS()
                Set ct = GDAL.CreateCoordinateTransformation(srs, latlong_srs)
            End If
        End If
</pre></div><p>Next we call a helper function to report each corner, and the center. We pass in the name of the corner, the pixel/line location at the corner, and the geotransform and transformer object.</p>
<div class="fragment"><pre class="fragment">        Call ReportCorner(<span class="stringliteral">&quot;Top Left      &quot;</span>, 0, 0, _
                          Geotransform, ct)
        Call ReportCorner(&quot;Top Right     &quot;, ds.XSize, 0, _
                          Geotransform, ct)
        Call ReportCorner(&quot;Bottom Left   &quot;, 0, ds.YSize, _
                          Geotransform, ct)
        Call ReportCorner(&quot;Bottom Right  &quot;, ds.XSize, ds.YSize, _
                          Geotransform, ct)
        Call ReportCorner(&quot;Center        &quot;, ds.XSize / 2<span class="preprocessor">#, ds.YSize / 2#, _</span>
<span class="preprocessor">                          Geotransform, ct)</span>
</pre></div><p>The ReportCorner subroutine starts by computing the corresponding georeferenced x and y location using the pixel/line coordinates and the geotransform.</p>
<div class="fragment"><pre class="fragment">Private Sub ReportCorner(CornerName As String, pixel As Double, line As Double, _
                         gt() As Double, ct As OGRCoordinateTransformation)
                             
    Dim geox As Double, geoy As Double
    
    geox = gt(0) + pixel * gt(1) + line * gt(2)
    geoy = gt(3) + pixel * gt(4) + line * gt(5)
</pre></div><p>Next, if we have a transformer, we use it to compute a corresponding latitude and longitude.</p>
<div class="fragment"><pre class="fragment">    Dim longitude As Double, latitude As Double, Z As Double
    Dim latlong_valid As Boolean

    latlong_valid = False
    
    If ct.IsValid() Then
        Z = 0
        longitude = geox
        latitude = geoy
        latlong_valid = ct.TransformOne(longitude, latitude, Z)
    End If
</pre></div><p>Then we report the corner location in georeferenced, and if we have it geographic coordinates.</p>
<div class="fragment"><pre class="fragment">    If latlong_valid Then
        Print CornerName &amp; geox &amp; <span class="stringliteral">&quot;,&quot;</span> &amp; geoy &amp; <span class="stringliteral">&quot;    &quot;</span> &amp; longitude &amp; <span class="stringliteral">&quot;,&quot;</span> &amp; latitude
    Else
        Print CornerName &amp; geox &amp; <span class="stringliteral">&quot;,&quot;</span> &amp; geoy
    End If
End Sub
</pre></div> 
<p>
$Id: vb6_tutorial.dox 13528 2008-01-14 19:37:42Z warmerdam $
</p>
 </div>
<hr>

Generated for GDAL by 
<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.7.1.
</body>
</html>
